
{
  "parameters": {
    "tenantId": "${TENANT_ID}",
    "subscriptionId": "${SUBSCRIPTION_ID}",
    "resourceGroup": "${RESOURCE_GROUP}",
    "location": "${LOCATION}",
    "purviewAccountName": "${PURVIEW_ACCOUNT}",
    "aiFoundryName": "${AI_FOUNDRY_NAME}",
    "keyVaultName": "${KEYVAULT_NAME}",
    "logAnalyticsWorkspaceName": "${LOG_ANALYTICS_NAME}",
    "contentSafetyAccountName": "${CONTENT_SAFETY_NAME}",
    "contentSafetySecretName": "${CONTENT_SAFETY_SECRET_NAME}",
    "storageAccountName": "${STORAGE_ACCOUNT_NAME}",
    "sqlServerName": "${SQL_SERVER_NAME}",
    "databaseName": "${DATABASE_NAME}"
  },

  "derived": {
    "aiFoundryResourceId": "/subscriptions/${parameters.subscriptionId}/resourceGroups/${parameters.resourceGroup}/providers/Microsoft.CognitiveServices/accounts/${parameters.aiFoundryName}",
    "keyVaultResourceId": "/subscriptions/${parameters.subscriptionId}/resourceGroups/${parameters.resourceGroup}/providers/Microsoft.KeyVault/vaults/${parameters.keyVaultName}",
    "logAnalyticsWorkspaceId": "/subscriptions/${parameters.subscriptionId}/resourceGroups/${parameters.resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/${parameters.logAnalyticsWorkspaceName}",
    "storageAccountResourceId": "/subscriptions/${parameters.subscriptionId}/resourceGroups/${parameters.resourceGroup}/providers/Microsoft.Storage/storageAccounts/${parameters.storageAccountName}",
    "sqlDatabaseResourceId": "/subscriptions/${parameters.subscriptionId}/resourceGroups/${parameters.resourceGroup}/providers/Microsoft.Sql/servers/${parameters.sqlServerName}/databases/${parameters.databaseName}",
    "contentSafetyEndpoint": "https://${parameters.contentSafetyAccountName}.cognitiveservices.azure.com"
  },

  "purviewAccount": "${parameters.purviewAccountName}",

  "aiFoundry": {
    "name": "${parameters.aiFoundryName}",
    "resourceId": "${derived.aiFoundryResourceId}"
  },

  "contentSafety": {
    "endpoint": "${derived.contentSafetyEndpoint}",
    "keyVault": {
      "vaultName": "${parameters.keyVaultName}",
      "resourceId": "${derived.keyVaultResourceId}",
      "secretName": "${parameters.contentSafetySecretName}"
    }
  },

  "logAnalyticsWorkspaceId": "${derived.logAnalyticsWorkspaceId}",

  "dataSources": [
    {
      "name": "ds-storage-01",
      "type": "AzureStorage",
      "resourceId": "${derived.storageAccountResourceId}"
    },
    {
      "name": "ds-sql-01",
      "type": "AzureSqlDatabase",
      "resourceId": "${derived.sqlDatabaseResourceId}"
    }
  ],

  "scans": [
    {
      "dataSource": "ds-storage-01",
      "name": "scan-storage-01",
      "rulesetType": "System",
      "rulesetName": "AzureStorage"
    },
    {
      "dataSource": "ds-sql-01",
      "name": "scan-sql-01",
      "rulesetType": "System",
      "rulesetName": "AzureSqlDatabase"
    }
  ],

  "dlpPolicy": {
    "name": "AI Egress Control",
    "mode": "Enforce",
    "locations": {
      "Exchange": "All",
      "SharePoint": "All",
      "OneDrive": "All",
      "Teams": "All"
    },
    "rules": [
      {
        "name": "Block Sensitive Data to AI Destinations",
        "sensitiveInfoTypes": [
          { "name": "Credit Card Number", "count": 1, "confidence": 85 },
          { "name": "U.S. Social Security Number (SSN)", "count": 1, "confidence": 85 }
        ],
        "blockAccess": true,
        "notifyUser": true
      }
    ]
  },

  "labels": [
    {
      "name": "Confidential",
      "publishPolicyName": "Publish: Confidential",
      "encryptionEnabled": true,
      "publishScopes": {
        "Exchange": "All",
        "SharePoint": "All",
        "OneDrive": "All"
      }
    }
  ],

  "retentionPolicies": [
    {
      "name": "AI Data â€“ 7 Years",
      "rules": [
        {
          "name": "Keep 7y then Delete",
          "durationDays": 2557,
          "action": "Delete"
        }
      ],
      "locations": {
        "Exchange": "All",
        "SharePoint": "All",
        "OneDrive": "All",
        "TeamsChat": "All",
        "TeamsChannel": "All"
      }
    }
  ],

  "activityExport": {
    "outputPath": "./audit_export",
    "contentTypes": [
      "Audit.General",
      "Audit.SharePoint",
      "Audit.Exchange",
      "DLP.All",
      "Audit.AzureActiveDirectory",
      "Audit.PowerBI"
    ]
  },

  "azurePolicies": [
    {
      "name": "deny-public-access-cognitiveservices",
      "displayName": "Cognitive Services accounts should disable public network access",
      "scope": "resourceGroup",
      "parameters": {}
    },
    {
      "name": "require-private-endpoints-storage",
      "displayName": "Storage accounts should use private link",
      "scope": "resourceGroup",
      "parameters": {}
    }
  ],

  "defenderForAI": {
    "enableDefenderForCloudPlans": [
      "CognitiveServices",
      "Storage",
      "Containers"
    ],
    "diagnosticCategories": [
      "Audit",
      "RequestResponse",
      "AllMetrics"
    ]
  }

