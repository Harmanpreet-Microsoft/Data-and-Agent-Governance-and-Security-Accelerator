name: DSPM Automation
on:
  workflow_dispatch:
jobs:
  dspm:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install PowerShell Modules
        run: |
          Install-Module Az.Accounts -Force
          Install-Module Az.Resources -Force
          Install-Module Az.Purview -Force
          Install-Module ExchangeOnlineManagement -Force
      - name: Run DSPM Scripts
        run: |
          pwsh ./00-New-DspmSpec.ps1 -OutFile ./spec.dspm.json
          pwsh ./01-Ensure-ResourceGroup.ps1 -SpecPath ./spec.dspm.json
          pwsh ./02-Ensure-PurviewAccount.ps1 -SpecPath ./spec.dspm.json
          pwsh ./11-Enable-UnifiedAudit.ps1
